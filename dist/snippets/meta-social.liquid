{% comment %}
// Generated by CyberCore Quantum Forge v3.0.0 //
  META-SOCIAL.LIQUID
  Social media metadata tags for CyberCore themes
  
  @MutationCompatible: CyberLotus, ObsidianBloom
  @StrategyProfile: quantum-entangled
  @Version: 1.0.0
{% endcomment %}

{%- comment -%}
  This snippet handles social media metadata (Open Graph and Twitter Cards)
  Parameters:
  - page: Current page object (optional)
  - product: Current product object (optional)
{%- endcomment -%}

{%- liquid
  # Default values
  assign og_title = page_title | default: shop.name
  assign og_description = page_description | default: shop.description | escape
  assign og_image = settings.share_image | image_url: width: 1200 | prepend: 'https:'
  assign og_url = canonical_url | default: shop.url
  assign og_type = 'website'
  
  # Product-specific overrides
  if product
    assign og_title = product.title | strip_html | escape
    assign og_description = product.description | strip_html | truncatewords: 30 | escape
    assign og_image = product.featured_media.preview_image | image_url: width: 1200 | prepend: 'https:'
    assign og_type = 'product'
    
    # Product-specific structured data
    assign product_structured_data = true
  endif
  
  # Article/page specifics
  if template.name == 'article'
    assign og_type = 'article'
    if article.image
      assign og_image = article.image | image_url: width: 1200 | prepend: 'https:'
    endif
  endif
-%}

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{{ og_type | default: 'website' }}">
<meta property="og:url" content="{{ canonical_url | default: shop.url }}">
<meta property="og:title" content="{{ og_title | default: page_title | default: shop.name }}">
<meta property="og:description" content="{{ og_description | default: page_description | default: shop.description | strip_html | truncate: 160 }}">
{% if og_image %}
  <meta property="og:image" content="{{ og_image | img_url: '1200x630', crop: 'center' }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="{{ og_image_alt | default: og_title }}">
{% elsif product.featured_image %}
  <meta property="og:image" content="{{ product.featured_image | img_url: '1200x630', crop: 'center' }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="{{ product.featured_image.alt | default: product.title }}">
{% elsif collection.image %}
  <meta property="og:image" content="{{ collection.image | img_url: '1200x630', crop: 'center' }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="{{ collection.title }}">
{% elsif article.image %}
  <meta property="og:image" content="{{ article.image | img_url: '1200x630', crop: 'center' }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="{{ article.title }}">
{% else %}
  <meta property="og:image" content="{{ 'social-share.jpg' | asset_url }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="{{ shop.name }}">
{% endif %}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ canonical_url | default: shop.url }}">
<meta name="twitter:title" content="{{ og_title | default: page_title | default: shop.name }}">
<meta name="twitter:description" content="{{ og_description | default: page_description | default: shop.description | strip_html | truncate: 160 }}">
{% if og_image %}
  <meta name="twitter:image" content="{{ og_image | img_url: '1200x630', crop: 'center' }}">
  <meta name="twitter:image:alt" content="{{ og_image_alt | default: og_title }}">
{% elsif product.featured_image %}
  <meta name="twitter:image" content="{{ product.featured_image | img_url: '1200x630', crop: 'center' }}">
  <meta name="twitter:image:alt" content="{{ product.featured_image.alt | default: product.title }}">
{% elsif collection.image %}
  <meta name="twitter:image" content="{{ collection.image | img_url: '1200x630', crop: 'center' }}">
  <meta name="twitter:image:alt" content="{{ collection.title }}">
{% elsif article.image %}
  <meta name="twitter:image" content="{{ article.image | img_url: '1200x630', crop: 'center' }}">
  <meta name="twitter:image:alt" content="{{ article.title }}">
{% else %}
  <meta name="twitter:image" content="{{ 'social-share.jpg' | asset_url }}">
  <meta name="twitter:image:alt" content="{{ shop.name }}">
{% endif %}

<!-- Additional cyberpunk metadata for compatible platforms -->
{% if settings.enable_cybercore_metadata %}
  <meta property="theme:mutation" content="{{ settings.mutation_profile | default: 'CyberLotus' }}">
  <meta property="theme:version" content="CyberCore 3.0.0">
  <meta property="theme:quantum" content="enabled">
{% endif %}

{% if product_structured_data %}
<!-- Product Structured Data -->
<script type="application/ld+json" nonce="{{ csp_nonce }}">
{
  "@context": "https://schema.org/",
  "@type": "Product",
  "name": {{ product.title | json }},
  "url": {{ request.origin | append: product.url | json }},
  {% if product.featured_media %}
    "image": [
      {{ product.featured_media | image_url: width: 1200 | prepend: 'https:' | json }}
    ],
  {% endif %}
  "description": {{ product.description | strip_html | truncatewords: 50 | json }},
  "brand": {
    "@type": "Brand",
    "name": {{ product.vendor | json }}
  },
  {% if product.variants.first.sku != blank %}
    "sku": {{ product.variants.first.sku | json }},
  {% endif %}
  "offers": {
    "@type": "Offer",
    "url": {{ request.origin | append: product.url | json }},
    "priceCurrency": {{ cart.currency.iso_code | json }},
    "price": {{ product.price | money_without_currency | strip_html | json }},
    "availability": {% if product.available %}"https://schema.org/InStock"{% else %}"https://schema.org/OutOfStock"{% endif %}
  }
}
</script>
{% endif %}

{% if template.name == 'article' %}
<!-- Article Structured Data -->
<script type="application/ld+json" nonce="{{ csp_nonce }}">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": {{ article.title | json }},
  "description": {{ article.excerpt_or_content | strip_html | truncatewords: 40 | json }},
  "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%SZ' | json }},
  "dateModified": {{ article.updated_at | date: '%Y-%m-%dT%H:%M:%SZ' | json }},
  "image": {% if article.image %}{{ article.image | image_url: width: 1200 | prepend: 'https:' | json }}{% else %}{{ settings.share_image | image_url: width: 1200 | prepend: 'https:' | json }}{% endif %},
  "author": {
    "@type": "Person",
    "name": {{ article.author | json }}
  },
  "publisher": {
    "@type": "Organization",
    "name": {{ shop.name | json }},
    "logo": {
      "@type": "ImageObject",
      "url": {{ settings.logo | image_url: width: 600 | prepend: 'https:' | json }}
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ request.origin | append: article.url | json }}
  }
}
</script>
{% endif %}